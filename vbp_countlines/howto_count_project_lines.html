<HTML>
<META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.rsac.org/ratingsv01.html" l gen true comment "RSACi North America Server" by "RodStephens@vb-helper.com" for "http://www.vb-helper.com" on "1998.03.17T18:18-0800" r (n 0 s 0 v 0 l 0))'>
<HEAD>
<TITLE>VB Helper: HowTo: Count the lines of code in a Visual Basic 5/6 project</TITLE>
<META NAME="Author" CONTENT="Rod Stephens">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META HTTP-EQUIV="Keywords" CONTENT="count lines, project, forms, modules, subs, subroutines, functions">
<META NAME="Keywords" CONTENT="count lines, project, forms, modules, subs, subroutines, functions">
<META NAME="Description" CONTENT="VB Helper: HowTo: Count the lines of code in a Visual Basic 5/6 project">
<META NAME="Copyright" CONTENT="Copyright 1997-2003, Rocky Mountain Computer Consulting, Inc.">
<META NAME="Rating" CONTENT="General">
<META NAME="Robots" CONTENT="All">
</HEAD>

<BODY BGCOLOR="#E1F3FF" BACKGROUND="bg_blue.jpg">

  <!-- This table contains the banner, menu column, and content. -->
  <TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0">
    <!-- ****** -->
    <!-- Banner -->
    <!-- ****** -->
    <TR><TD>
      <TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0" ALIGN="Left">
        <TR>
          <TD BACKGROUND="banner_mid.jpg"><IMG SRC="banner_l.jpg" WIDTH="410" HEIGHT="64"></TD>
          <TD BGCOLOR="#E1F3FF"><IMG SRC="banner_r.jpg" WIDTH="32" HEIGHT="64"></TD>
        </TR>
      </TABLE>
    </TD></TR>
    <TR><TD>&nbsp;</TD></TR>

    <!-- Menu column and content -->
    <TR><TD>
      <TABLE WIDTH="100%" BORDER="0" CELLSPACING="2" CELLPADDING="0">
        <!-- *********** -->
        <!-- Menu column -->
        <!-- *********** -->
        <TR>
          <TD ALIGN="Left" VALIGN="Top">
            <TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
              <!-- Menu top -->
              <TR>
                <TD><IMG SRC="blue_ul.jpg" WIDTH="16" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_um.jpg" WIDTH="93" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_ur.jpg" WIDTH="16" HEIGHT="16"></TD>
              </TR>

              <!-- Menu entries -->
              <TR BGCOLOR="#7FCFFF">
                <TD BACKGROUND="blue_l.jpg" WIDTH="16">&nbsp;</TD>
                <TD><CENTER>
                  <A HREF="index.html"><B><FONT SIZE="+1">Home</FONT></B></A><BR>
                  <A HREF="search.html"><B>Search</B></A><BR>
                  &nbsp;<BR>
                  <A HREF="whats_new.html"><B>What's New</B></A><BR>
                  <A HREF="index_categories.html"><B>Index</B></A><BR>
                  <A HREF="books.html"><B>Books</B></A><BR>
                  <A HREF="links.html"><B>Links</B></A><BR>
                  <A HREF="http://www.topica.com/lists/VBHelperQA/read"><B>Q &amp; A</B></A><BR>
                  <A HREF="newsletter.html"><B>Newsletter</B></A><BR>
                  <A HREF="banners.html"><B>Banners</B></A><BR>
                  &nbsp;<BR>
                  <A HREF="mailto:feedback@vb-helper.com"><B>Feedback</B></A><BR>
                  <A HREF="tip_jar.html"><B>Tip Jar</B></A><BR>
                  &nbsp;<BR>
                  <A HREF="feed.xml"><IMG SRC="xml_rss.jpg" BORDER="0" ALT="XML RSS Feed"></A><BR>
                </CENTER></TD>
                <TD BACKGROUND="blue_r.jpg" WIDTH="16">&nbsp;</TD>
              </TR>

              <!-- Menu bottom -->
              <TR>
                <TD><IMG SRC="blue_ll.jpg" WIDTH="16" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_lm.jpg" WIDTH="93" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_lr.jpg" WIDTH="16" HEIGHT="16"></TD>
              </TR>

              <TR><TD HEIGHT="50" COLSPAN="3">&nbsp;</TR></TD>

              <!-- ******** -->
              <!-- Partners -->
              <!-- ******** -->

              <!-- MVP -->
              <TR><TD COLSPAN="3"><A HREF="http://www.mvps.org"><IMG SRC="mvp_logo.gif" BORDER="0"></A></TR></TD>
              <TR><TD HEIGHT="20" COLSPAN="3">&nbsp;</TR></TD>

              <!-- MSDN VB Community -->
              <TR><TD COLSPAN="3" ALIGN="Center">
<A HREF="http://msdn.microsoft.com/vbasic/community/default.aspx">MSDN Visual Basic Community</A>
              </TD></TR>
              <TR><TD HEIGHT="50" COLSPAN="3">&nbsp;</TR></TD>

              <!-- Amazon Recommends -->
              <TR><TD COLSPAN="3" ALIGN="Center">
<!-- -->
                <SCRIPT SRC="http://rcm.amazon.com/e/cm?t=vbhelper&l=rc1&p=2&o=1" TYPE="text/JavaScript"></SCRIPT>
<!-- -->
                <NOSCRIPT>
                  <TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="125">
                    <TR><TD>
                      <MAP NAME="boxmap">
                        <AREA SHAPE="RECT" COORDS="18, 263, 105, 274" HREF="http://rcm.amazon.com/e/cm/privacy-policy.html?o=1">
                        <AREA COORDS="0,0,10000,10000" HREF="http://www.amazon.com/exec/obidos/redirect-home/vbhelper">
                      </MAP>
                      <img src="http://rcm-images.amazon.com/images/G/01/associates/amzn_recommends/gnbox125x275.gif" width="125" height="275" border="0" usemap="#boxmap">
                    </TD></TR>
                  </TABLE>
                </NOSCRIPT>
              </TD></TR>
              <TR><TD HEIGHT="50" COLSPAN="3">&nbsp;</TR></TD>

              <!-- Wiley -->
              <TR><TD COLSPAN="3" ALIGN="Center" BACKGROUND="sandpaper.gif"><A HREF="http://service.bfast.com/bfast/click?bfmid=37920629&siteid=40078832&bfpage=computer_science" TARGET="_top"><IMG SRC="wiley_logo.gif" BORDER="0" ALIGN="Center" WIDTH="77" HEIGHT="105"></TD></TR>
              <TR><TD HEIGHT="10" COLSPAN="3">&nbsp;</TR></TD>

              <!-- Que -->
              <TR><TD COLSPAN="3" ALIGN="Center"><A HREF="http://www.quepublishing.com"><IMG SRC="que.gif" BORDER="0" ALIGN="Center" WIDTH="121" HEIGHT="36"></A></TD></TR>
              <TR><TD HEIGHT="10" COLSPAN="3">&nbsp;</TR></TD>

              <!-- Amazon -->
              <TR><TD COLSPAN="3" ALIGN="Center"><A HREF="amazon.html"><IMG SRC="amazon_logo.gif" BORDER="0" ALIGN="Center" WIDTH="68" HEIGHT="65"></A></TD></TR>
              <TR><TD HEIGHT="10" COLSPAN="3">&nbsp;</TR></TD>

              <!-- ********** -->
              <!-- More stuff -->
              <!-- ********** -->

            </TABLE>
          </TD>

          <!-- A little space between the menus and content -->
          <TD WIDTH="5">&nbsp;</TD>

          <!-- ******* -->
          <!-- Content -->
          <!-- ******* -->
          <TD WIDTH="100%" ALIGN="Left" VALIGN="Top">
            <TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0">
              <!-- How To Summary -->
              <TR><TD>
                <TABLE WIDTH="100%" BORDER="2" CELLSPACING="0" CELLPADDING="2">
                  <TR><TH ALIGN="Left">Title</TH><TD WIDTH="100%">Count the lines of code in a Visual Basic 5/6 project</TD></TR>
                  <TR><TH ALIGN="Left">Description</TH><TD WIDTH="100%">This example shows how to count the lines of code in a Visual Basic 5/6 project.</TD></TR>
                  <TR><TH ALIGN="Left">Keywords</TH><TD>count lines, project, forms, modules, subs, subroutines, functions</TD></TR>
                  <TR><TH ALIGN="Left">Categories</TH><TD>Software Engineering</TD></TR>
                </TABLE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
This program lets you select a .VBP file. It opens the file and finds the frm, bas, and cls files it uses.
<P>
The program then opens those files. It finds the start and finish of the frm files' control declarations and it counts the subroutines, functions, properties, and lines in the rest of the file.
<P>
This is a fairly simplistic method that I threw together to give me an idea of how many lines of code I was managing. You could make the program much smarter and have it count control types, code in event handlers, etc. <A HREF="mailto:RodStephens@vb-helper.com">Let me know</A> if you make improvements.
              </TD></TR>

              <!-- Code content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR>
                <TD BACKGROUND="computer_paper.jpg">
                  <PRE><FONT NAME="Courier New" POINT-SIZE="10" SIZE="2"><FONT COLOR="#008000">' Return a report on a project.</FONT>
Private Function ReportOnProject(ByVal project_file As _
    String) As String
Dim project_dir As String
Dim fnum As Integer
Dim new_line As String
Dim project_forms As Collection
Dim project_modules As Collection
Dim project_classes As Collection
Dim i As Integer
Dim txt As String
Dim total_lines As Long
Dim total_controls As Long
Dim total_subs As Long
Dim total_functions As Long
Dim total_properties As Long
Dim total_comments As Long

    <FONT COLOR="#008000">' Get the project directory.</FONT>
    project_dir = Left$(project_file, _
        InStrRev(project_file, "\"))

    <FONT COLOR="#008000">' Process the project file.</FONT>
    fnum = FreeFile
    Open project_file For Input As fnum

    Set project_forms = New Collection
    Set project_modules = New Collection
    Set project_classes = New Collection

    <FONT COLOR="#008000">' Read the lines in the project file.</FONT>
    Do While Not EOF(fnum)
        <FONT COLOR="#008000">' Read a line.</FONT>
        Line Input #fnum, new_line

        <FONT COLOR="#008000">' See what this line is.</FONT>
        If PrefixMatches(new_line, TOKEN_FORM) Then
            <FONT COLOR="#008000">' It's a form.</FONT>
            project_forms.Add Mid$(new_line, _
                Len(TOKEN_FORM) + 1)
        ElseIf PrefixMatches(new_line, TOKEN_MODULE) Then
            <FONT COLOR="#008000">' It's a module.</FONT>
            project_modules.Add Trim$(Mid$(new_line, _
                InStr(new_line, ";") + 1))
        ElseIf PrefixMatches(new_line, TOKEN_CLASS) Then
            <FONT COLOR="#008000">' It's a class.</FONT>
            project_classes.Add Trim$(Mid$(new_line, _
                InStr(new_line, ";") + 1))
        End If
    Loop

    <FONT COLOR="#008000">' Close the project file.</FONT>
    Close fnum

    <FONT COLOR="#008000">' Sort the collections.</FONT>
    SortCollection project_forms
    SortCollection project_modules

    <FONT COLOR="#008000">' Start the report.</FONT>
    txt = "Project:    " &amp; project_file &amp; vbCrLf

    <FONT COLOR="#008000">' Process the forms.</FONT>
    If project_forms.Count &gt; 0 Then
        txt = txt &amp; vbCrLf
        txt = txt &amp; "*************" &amp; vbCrLf
        txt = txt &amp; "*** FORMS ***" &amp; vbCrLf
        txt = txt &amp; "*************" &amp; vbCrLf
        For i = 1 To project_forms.Count
            txt = txt &amp; vbCrLf &amp; ReportOnForm(project_dir, _
                project_forms(i), total_lines, _
                total_controls, total_subs, _
                total_functions, total_properties, _
                total_comments)
        Next i
    End If

    <FONT COLOR="#008000">' Process the modules.</FONT>
    If project_modules.Count &gt; 0 Then
        txt = txt &amp; vbCrLf
        txt = txt &amp; "***************" &amp; vbCrLf
        txt = txt &amp; "*** MODULES ***" &amp; vbCrLf
        txt = txt &amp; "***************" &amp; vbCrLf
        For i = 1 To project_modules.Count
            txt = txt &amp; vbCrLf &amp; _
                ReportOnModule(project_dir, _
                project_modules(i), "Module", total_lines, _
                total_controls, total_subs, _
                total_functions, total_properties, _
                total_comments)
        Next i
    End If

    <FONT COLOR="#008000">' Process the classes.</FONT>
    If project_classes.Count &gt; 0 Then
        txt = txt &amp; vbCrLf
        txt = txt &amp; "***************" &amp; vbCrLf
        txt = txt &amp; "*** CLASSES ***" &amp; vbCrLf
        txt = txt &amp; "***************" &amp; vbCrLf
        For i = 1 To project_classes.Count
            txt = txt &amp; vbCrLf &amp; _
                ReportOnModule(project_dir, _
                project_classes(i), "Class", total_lines, _
                total_controls, total_subs, _
                total_functions, total_properties, _
                total_comments)
        Next i
    End If

    <FONT COLOR="#008000">' Return the result.</FONT>
    txt = txt &amp; vbCrLf
    txt = txt &amp; "***************" &amp; vbCrLf
    txt = txt &amp; "*** SUMMARY ***" &amp; vbCrLf
    txt = txt &amp; "***************" &amp; vbCrLf
    txt = txt &amp; vbCrLf
    txt = txt &amp; "Forms:            " &amp; _
        Format$(project_forms.Count, "@@@@@@@") &amp; vbCrLf
    txt = txt &amp; "Modules:          " &amp; _
        Format$(project_modules.Count, "@@@@@@@") &amp; vbCrLf
    txt = txt &amp; "Classes:          " &amp; _
        Format$(project_classes.Count, "@@@@@@@") &amp; vbCrLf
    txt = txt &amp; "Total Controls:   " &amp; _
        Format$(total_controls, "@@@@@@@") &amp; vbCrLf
    txt = txt &amp; "Total Lines:      " &amp; Format$(total_lines, _
        "@@@@@@@") &amp; vbCrLf
    txt = txt &amp; "Total Subs:       " &amp; Format$(total_subs, _
        "@@@@@@@") &amp; vbCrLf
    txt = txt &amp; "Total Functions:  " &amp; _
        Format$(total_functions, "@@@@@@@") &amp; vbCrLf
    txt = txt &amp; "Total Properties: " &amp; _
        Format$(total_properties, "@@@@@@@") &amp; vbCrLf
    txt = txt &amp; "Total Comments:   " &amp; _
        Format$(total_comments, "@@@@@@@") &amp; vbCrLf

    ReportOnProject = txt
End Function

<FONT COLOR="#008000">' Return a report about a form.</FONT>
Private Function ReportOnForm(ByVal project_dir As String, _
    ByVal form_file As String, ByRef total_lines As Long, _
    ByRef total_controls As Long, ByRef total_subs As Long, _
    ByRef total_functions As Long, ByRef total_properties _
    As Long, ByRef total_comments As Long) As String
Dim txt As String
Dim fnum As Integer
Dim new_line As String
Dim begins_open As Long
Dim num_controls As Long
Dim num_lines As Long
Dim num_functions As Long
Dim num_subs As Long
Dim num_properties As Long
Dim num_Comments As Long

    txt = "Form:       " &amp; form_file &amp; vbCrLf

    fnum = FreeFile
    On Error Resume Next
    Open project_dir &amp; form_file For Input As fnum
    If Err.Number &lt;&gt; 0 Then
        txt = txt &amp; "*** Error " &amp; _
            Format$(Err.Number) &amp; _
            " opening form file " &amp; _
            project_dir &amp; form_file &amp; _
            vbCrLf &amp; Err.Description
        ReportOnForm = txt
        Exit Function
    End If
    On Error GoTo 0

    <FONT COLOR="#008000">' Find the "Begin VB.Form" line.</FONT>
    Do While Not EOF(fnum)
        Line Input #fnum, new_line
        new_line = Trim$(new_line)
        If PrefixMatches(new_line, TOKEN_BEGIN) _
            Then Exit Do
    Loop

    <FONT COLOR="#008000">' Search for the corresponding End.</FONT>
    begins_open = 1
    Do While Not EOF(fnum)
        Line Input #fnum, new_line
        new_line = Trim$(new_line)
        If PrefixMatches(new_line, TOKEN_BEGIN) Then
            num_controls = num_controls + 1
            begins_open = begins_open + 1
        ElseIf PrefixMatches(new_line, TOKEN_END) Then
            begins_open = begins_open - 1
            If begins_open &lt; 1 Then Exit Do
        End If
    Loop

    <FONT COLOR="#008000">' Count the remaining lines.</FONT>
    CountTheRest fnum, num_lines, num_subs, num_functions, _
        num_properties, num_Comments

    <FONT COLOR="#008000">' Close the form file.</FONT>
    Close fnum

    total_lines = total_lines + num_lines
    total_controls = total_controls + num_controls
    total_subs = total_subs + num_subs
    total_functions = total_functions + num_functions
    total_properties = total_properties + num_properties
    total_comments = total_comments + num_Comments
    ReportOnForm = txt &amp; _
        "Lines:      " &amp; Format$(num_lines, "@@@@@@@") &amp; _
            vbCrLf &amp; _
        "Controls:   " &amp; Format$(num_controls, "@@@@@@@") &amp; _
            vbCrLf &amp; _
        "Subs:       " &amp; Format$(num_subs, "@@@@@@@") &amp; _
            vbCrLf &amp; _
        "Functions:  " &amp; Format$(num_functions, "@@@@@@@") _
            &amp; vbCrLf &amp; _
        "Properties: " &amp; Format$(num_properties, "@@@@@@@") _
            &amp; vbCrLf &amp; _
        "Comments:   " &amp; Format$(num_Comments, "@@@@@@@") &amp; _
            vbCrLf
End Function</FONT></PRE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
Function ReportOnModule and subroutine CountTheRest are similar to ReportOnForm so they are not shown here.
              </TD></TR>

              <!-- *************** -->
              <!-- Download button -->
              <!-- *************** -->

              <TR><TD><FONT SIZE="-2">&nbsp;</FONT></TD></TR>
              <TR><TD ALIGN="Center"><A HREF="HowTo/howto_count_project_lines.zip"><IMG SRC="download.jpg" BORDER="0"></A></TD></TR>
              <TR><TD><FONT SIZE="-2">&nbsp;</FONT></TD></TR>

            </TABLE> <!-- End content table -->
          </TD> <!-- End content column -->

          <!-- ************** -->
          <!-- Google AdSense -->
          <!-- ************** -->
          <TD WIDTH="120" ALIGN="Right" VALIGN="Top">
            <TABLE WIDTH="165" BORDER="0" CELLSPACING="0" CELLPADDING="0">
              <TR><TD ALIGN="Right">

<script type="text/javascript"><!--
google_ad_client = "pub-6627515316741006";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_channel ="4974732445";
google_color_border = "00CC66";
google_color_bg = "99FF99";
google_color_link = "0000FF";
google_color_url = "0033FF";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

              </TD></TR>
            </TABLE> <!-- End Google AdSense table -->
          </TD> <!-- End Google AdSense column -->


        </TR> <!-- End row containing menu column and content -->
      </TABLE> <!-- End table containing menu column and content -->
    </TD></TR>

    <!-- ****** -->
    <!-- Footer -->
    <!-- ****** -->
    <TR><TD WIDTH="100%">
      <TABLE WIDTH="100%" BORDER="0" BGCOLOR="#87CEFA" CELLSPACING="0" CELLPADDING="0">
        <!-- Top row -->
        <TR>
          <TD BGCOLOR="#E1F3FF" ALIGN="Right" WIDTH="16"><IMG SRC="blue_ul.jpg" WIDTH="16" HEIGHT="16"></TD>
          <TD BACKGROUND="blue_um.jpg" COLSPAN="2" ALIGN="Center"><FONT SIZE="-2">
            Copyright &copy; 1997-2003 Rocky Mountain Computer Consulting, Inc. &nbsp; All rights reserved.
          </FONT></TD>
          <TD BGCOLOR="#E1F3FF"><IMG SRC="blue_ur.jpg" WIDTH="16" HEIGHT="16"></TD>
        </TR>

        <!-- Bottom row -->
        <TR>
          <TD BGCOLOR="#E1F3FF" ALIGN="Right" WIDTH="16"><IMG SRC="blue_ll.jpg" WIDTH="16" HEIGHT="16"></TD>
          <TD BACKGROUND="blue_lm.jpg"><FONT SIZE="-2">
            &nbsp;<SCRIPT LANGUAGE=JavaScript>document.write(document.URL)</SCRIPT></FONT></TD>
          <TD BACKGROUND="blue_lm.jpg" ALIGN="Right"><FONT SIZE="-2">
            Updated <SCRIPT LANGUAGE=JavaScript>document.write(document.lastModified)</SCRIPT> &nbsp;
          </FONT></TD>
          <TD BGCOLOR="#E1F3FF"><IMG SRC="blue_lr.jpg" WIDTH="16" HEIGHT="16"></TD>
        </TR>
      </TABLE>
    </TD></TR>
  </TABLE> <!-- End table containing banner, menu column + content, and footer -->

</BODY>
</HTML>